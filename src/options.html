<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZDFTranslate 设置</title>
  <link rel="stylesheet" href="styles/options.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-container">
        <img src="assets/logo-mark-512.png" alt="ZDFTranslate" class="logo-mark">
      </div>
      <h1>ZDFTranslate 设置</h1>
      <p>简洁、快速、可控的双语翻译体验</p>
    </header>

    <div class="settings-layout">
      <aside class="settings-sidebar">
        <div class="sidebar-title">设置导航</div>
        <a href="#sec-free" class="sidebar-link">服务快速配置</a>
        <a href="#sec-video" class="sidebar-link">一些开关选项</a>
        <a href="#sec-style" class="sidebar-link">外观设置</a>
        <a href="#sec-about" class="sidebar-link">关于</a>
      </aside>

      <main class="settings-main">

      <!-- 服务快速配置 -->
      <section class="card" id="sec-free">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="4" width="18" height="6" rx="2"/><rect x="3" y="14" width="18" height="6" rx="2"/><line x1="7" y1="7" x2="7.01" y2="7"/><line x1="7" y1="17" x2="7.01" y2="17"/><line x1="12" y1="7" x2="17" y2="7"/><line x1="12" y1="17" x2="17" y2="17"/></svg>
          </div>
          <div>
            <h2 class="card-title">翻译服务快速配置</h2>
            <p class="card-subtitle">配置翻译服务API与模型</p>
          </div>
        </div>

        <div class="form-group quick-service-picker">
          <label>当前使用服务</label>
          <select id="activeService">
            <option value="libretranslate">LibreTranslate（免费免配置）</option>
            <option value="aliyun">阿里云百炼</option>
            <option value="kimi">Kimi（月之暗面）</option>
            <option value="zhipu">智谱清言（GLM）</option>
            <option value="deepseek">DeepSeek</option>
            <option value="openai">OpenAI</option>
            <option value="openrouter">OpenRouter</option>
            <option value="google">Google Translate API</option>
            <option value="deepl">DeepL API</option>
            <option value="custom">自定义服务</option>
          </select>
          <p class="service-note">提示：选择后仅显示对应配置区域，保存即生效。</p>
        </div>
      </section>

      <!-- API 密钥设置 - 国内AI -->
      <section class="card" id="sec-cn">

        <div class="form-group">
          <label>阿里云百炼 API Key</label>
          <input type="password" id="aliyunApiKey" placeholder="输入阿里云百炼 API Key">
          <a href="https://bailian.console.aliyun.com/" target="_blank">如何获取？</a>
        </div>
        <div class="form-group model-select">
          <label>模型选择</label>
          <div class="model-input-wrapper">
            <select id="aliyunModel" class="model-select-dropdown">
              <option value="">加载默认模型...</option>
            </select>
            <input type="text" id="aliyunModelCustom" class="model-custom-input" placeholder="输入自定义模型名" style="display:none;">
          </div>
          <div class="model-actions">
            <button class="refresh-models" data-service="aliyun"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取远程模型</span></button>
            <button class="toggle-custom-model" data-service="aliyun"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
          </div>
          <span class="model-status" id="aliyunStatus"></span>
        </div>

        <div class="form-group">
          <label>Kimi API Key (月之暗面)</label>
          <input type="password" id="kimiApiKey" placeholder="输入 Kimi API Key">
          <a href="https://platform.moonshot.cn/" target="_blank">如何获取？</a>
        </div>
        <div class="form-group model-select">
          <label>模型选择</label>
          <div class="model-input-wrapper">
            <select id="kimiModel" class="model-select-dropdown">
              <option value="">加载默认模型...</option>
            </select>
            <input type="text" id="kimiModelCustom" class="model-custom-input" placeholder="输入自定义模型名" style="display:none;">
          </div>
          <div class="model-actions">
            <button class="refresh-models" data-service="kimi"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取远程模型</span></button>
            <button class="toggle-custom-model" data-service="kimi"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
          </div>
          <span class="model-status" id="kimiStatus"></span>
        </div>

        <div class="form-group">
          <label>智谱清言 API Key (GLM)</label>
          <input type="password" id="zhipuApiKey" placeholder="输入智谱清言 API Key">
          <a href="https://open.bigmodel.cn/" target="_blank">如何获取？</a>
        </div>
        <div class="form-group model-select">
          <label>模型选择</label>
          <div class="model-input-wrapper">
            <select id="zhipuModel" class="model-select-dropdown">
              <option value="">加载默认模型...</option>
            </select>
            <input type="text" id="zhipuModelCustom" class="model-custom-input" placeholder="输入最新模型名，如: glm-4.7" style="display:none;">
          </div>
          <div class="model-actions">
            <button class="refresh-models" data-service="zhipu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取远程模型</span></button>
            <button class="toggle-custom-model" data-service="zhipu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
          </div>
          <span class="model-status" id="zhipuStatus"></span>
        </div>

        <div class="form-group">
          <label>DeepSeek API Key</label>
          <input type="password" id="deepseekApiKey" placeholder="输入 DeepSeek API Key">
          <a href="https://platform.deepseek.com/" target="_blank">如何获取？</a>
        </div>
        <div class="form-group model-select">
          <label>模型选择</label>
          <div class="model-input-wrapper">
            <select id="deepseekModel" class="model-select-dropdown">
              <option value="">加载默认模型...</option>
            </select>
            <input type="text" id="deepseekModelCustom" class="model-custom-input" placeholder="输入自定义模型名" style="display:none;">
          </div>
          <div class="model-actions">
            <button class="refresh-models" data-service="deepseek"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取远程模型</span></button>
            <button class="toggle-custom-model" data-service="deepseek"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
          </div>
          <span class="model-status" id="deepseekStatus"></span>
        </div>
      </section>

      <!-- API 密钥设置 - 国际服务 -->
      <section class="card" id="sec-global">

        <div class="form-group">
          <label>Google Translate API Key</label>
          <input type="password" id="googleApiKey" placeholder="输入 Google API Key">
          <a href="https://cloud.google.com/translate/docs/setup" target="_blank">如何获取？</a>
        </div>

        <div class="form-group">
          <label>DeepL API Key</label>
          <input type="password" id="deeplApiKey" placeholder="输入 DeepL API Key">
          <a href="https://www.deepl.com/pro-api" target="_blank">如何获取？</a>
        </div>

        <div class="form-group">
          <label>OpenAI API Key</label>
          <input type="password" id="openaiApiKey" placeholder="输入 OpenAI API Key">
          <a href="https://platform.openai.com/api-keys" target="_blank">如何获取？</a>
        </div>

        <div class="form-group model-select">
          <label>模型选择</label>
          <div class="model-input-wrapper">
            <select id="openaiModel" class="model-select-dropdown">
              <option value="">加载默认模型...</option>
            </select>
            <input type="text" id="openaiModelCustom" class="model-custom-input" placeholder="输入自定义模型名" style="display:none;">
          </div>
          <div class="model-actions">
            <button class="refresh-models" data-service="openai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取远程模型</span></button>
            <button class="toggle-custom-model" data-service="openai"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
          </div>
          <span class="model-status" id="openaiStatus"></span>
        </div>

        <!-- OpenRouter 配置 -->
        <div class="form-group service-divider" id="openrouter-divider">
          <label>OpenRouter API Key</label>
          <input type="password" id="openrouterApiKey" placeholder="输入 OpenRouter API Key">
          <a href="https://openrouter.ai/keys" target="_blank">如何获取？</a>
        </div>
        <div class="form-group model-select">
          <label>模型选择</label>
          <div class="model-input-wrapper">
            <select id="openrouterModel" class="model-select-dropdown">
              <option value="">加载默认模型...</option>
            </select>
            <input type="text" id="openrouterModelCustom" class="model-custom-input" placeholder="输入自定义模型名" style="display:none;">
          </div>
          <div class="model-actions">
            <button class="refresh-models" data-service="openrouter"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取远程模型</span></button>
            <button class="toggle-custom-model" data-service="openrouter"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
          </div>
          <span class="model-status" id="openrouterStatus"></span>
        </div>

        <!-- 自定义服务管理 -->
        <div class="form-group service-divider" id="custom-service-divider">
          <label>自定义翻译服务</label>
          <p class="service-note">添加兼容 OpenAI 或 Anthropic API 格式的自定义服务</p>
        </div>
        <div class="form-group">
          <button id="addCustomServiceBtn" class="btn-secondary"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg><span>添加自定义服务</span></button>
        </div>
        <div id="customServicesContainer">
          <!-- 动态加载自定义服务列表 -->
        </div>
        <!-- 自定义服务编辑模板 (隐藏) -->
        <div id="customServiceTemplate" style="display:none;">
          <div class="custom-service-card" data-service-id="">
            <div class="custom-service-header">
              <input type="text" class="custom-service-name" placeholder="服务名称">
              <button class="btn-icon delete-custom-service" title="删除" aria-label="删除">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                  <line x1="10" y1="11" x2="10" y2="17"/>
                  <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
              </button>
            </div>
            <div class="custom-service-body">
              <div class="form-row">
                <label>API Base URL</label>
                <input type="text" class="custom-service-baseurl" placeholder="https://api.example.com/v1">
              </div>
              <div class="form-row">
                <label>API Key</label>
                <input type="password" class="custom-service-apikey" placeholder="输入 API Key">
              </div>
              <div class="form-row">
                <label>兼容模式</label>
                <select class="custom-service-mode">
                  <option value="openai">OpenAI 兼容 (/v1/chat/completions)</option>
                  <option value="anthropic">Anthropic 兼容 (/v1/messages)</option>
                </select>
              </div>
              <div class="form-row model-select">
                <label>模型选择</label>
                <div class="model-input-wrapper">
                  <select class="custom-service-model model-select-dropdown">
                    <option value="">选择模型...</option>
                  </select>
                  <input type="text" class="custom-service-model-custom model-custom-input" placeholder="输入自定义模型名" style="display:none;">
                </div>
                <div class="model-actions">
                  <button class="refresh-custom-models"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10"/><path d="M20.49 15a9 9 0 0 1-14.13 3.36L1 14"/></svg><span>获取模型</span></button>
                  <button class="toggle-custom-model-custom"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg><span>自定义</span></button>
                </div>
                <span class="model-status custom-service-status"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 一些开关选项 -->
      <section class="card" id="sec-video">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 3l7 3v6c0 4.4-3 8.4-7 9-4-0.6-7-4.6-7-9V6l7-3z"/><path d="M9 12l2 2 4-4"/></svg>
          </div>
          <div>
            <h2 class="card-title">一些开关选项</h2>
            <p class="card-subtitle">YouTube 字幕与悬浮导出图标和水印控制</p>
          </div>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" id="autoTranslateYouTube">
            自动开启YouTube双语字幕
          </label>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" id="showFloatingImageExportButton">
            开启导出图片功能
          </label>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" id="showFloatingPdfExportButton">
            开启导出PDF功能
          </label>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" id="showWatermark" checked>
            开启水印功能
          </label>
        </div>
      </section>

      <!-- 外观设置 -->
      <section class="card" id="sec-style">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="13.5" cy="6.5" r="1"/>
              <circle cx="17.5" cy="10.5" r="1"/>
              <circle cx="8.5" cy="7.5" r="1"/>
              <circle cx="6.5" cy="12.5" r="1"/>
              <path d="M12 3a9 9 0 0 0 0 18h.6a2.4 2.4 0 0 0 2.4-2.4c0-.6-.2-1.1-.6-1.5-.4-.4-.6-.8-.6-1.3a2.2 2.2 0 0 1 2.2-2.2H18a3 3 0 0 0 3-3A8.8 8.8 0 0 0 12 3Z"/>
            </svg>
          </div>
          <div>
            <h2 class="card-title">外观设置</h2>
            <p class="card-subtitle">外观设置个性化</p>
          </div>
        </div>

        <div class="form-group">
          <label>译文颜色</label>
          <input type="color" id="translationColor" value="#111111">
        </div>

        <div class="form-group">
          <label>译文字号</label>
          <select id="translationSize">
            <option value="0.85em">小</option>
            <option value="0.95em" selected>中</option>
            <option value="1em">大</option>
          </select>
        </div>

        <div class="form-group">
          <label>行间距</label>
          <select id="lineSpacing">
            <option value="1.4">紧凑</option>
            <option value="1.6" selected>舒适</option>
            <option value="1.8">宽松</option>
          </select>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" id="backgroundHighlight">
            高亮译文背景
          </label>
        </div>

      </section>

      <!-- 关于 -->
      <section class="card" id="sec-about">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="12" cy="12" r="9"/>
              <path d="M12 11.5v5"/>
              <circle cx="12" cy="8" r="1" fill="currentColor" stroke="none"/>
            </svg>
          </div>
          <div>
            <h2 class="card-title">关于</h2>
            <p class="card-subtitle">版本: <span id="appVersion">-</span></p>
          </div>
        </div>
        <p>ZDFTranslate - 简单双语翻译插件</p>
      </section>
    </main>
    </div>

    <footer>
      <button id="saveBtn" class="btn-primary">保存设置</button>
      <button id="resetBtn" class="btn-secondary">恢复默认</button>
      <span id="saveStatus"></span>
    </footer>
  </div>

  <script src="options.js"></script>
</body>
</html>
